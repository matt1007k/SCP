(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{74:function(t,e,o){"use strict";o.r(e);var a={components:{SearchPerson:o(78).a},data:function(){return{form:{persona:{},anio:"",certificado:""},items_anio:[],lista_resultado:[],loading:!1,notFound:!1,msg:null,errors:{}}},created:function(){this.$auth.can("pagos.consultar")||this.$auth.isAdmin()?(document.title="Reporte de pagos por año",this.getYears()):this.$router.push("/admin/403")},methods:{getYears:function(){var t=this;axios.get("/periodos").then((function(e){return t.items_anio=e.data.years})).catch((function(t){return console.log(t)}))},onPerson:function(t){this.form.persona=t.target.value},buscarPago:function(){var t=this;this.loading=!0,axios.get("/search/por-anio",{params:{anio:this.form.anio,persona_id:this.form.persona.id,certificado:this.form.certificado}}).then((function(e){t.loading=!1,t.errors={},t.lista_resultado=e.data.pagos;var o=e.data.msg;o&&(t.loading=!1,t.notFound=!0,t.msg=o,t.lista_resultado={})})).catch((function(e){t.loading=!1,t.errors=e.response.data.errors}))},downloadPDF:function(t,e){var o=this,a={anio:this.form.anio,persona_id:this.form.persona.id,certificado:this.form.certificado,ver:0},s=window.btoa(JSON.stringify(a));axios({url:"/reporte/por-anio/".concat(s),method:"GET",responseType:"blob"}).then((function(t){var e=window.URL.createObjectURL(new Blob([t.data])),a=document.createElement("a"),s="".concat(o.form.persona.codigo_modular,"-").concat(o.form.anio,".pdf");a.href=e,a.setAttribute("download",s),document.body.appendChild(a),a.click()}))},viewPDF:function(t,e){var o={anio:this.form.anio,persona_id:this.form.persona.id,certificado:this.form.certificado,ver:0},a=window.btoa(JSON.stringify(o));window.open("/reporte/por-anio/".concat(a),"_blank")},getName:function(){return"".concat(this.form.persona.apellido_paterno," ").concat(this.form.persona.apellido_materno,", ").concat(this.form.persona.nombre," ")}}},s=o(6),n=Object(s.a)(a,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("v-container",[o("v-layout",{staticClass:"mb-3",attrs:{row:"",wrap:""}},[o("v-flex",{attrs:{xs12:""}},[o("v-card",[o("v-container",{attrs:{"fill-height":"",fluid:""}},[o("v-layout",{attrs:{row:"",wrap:""}},[o("v-flex",{staticClass:"mb-3",attrs:{xs12:""}},[o("span",{staticClass:"headline"},[t._v("Reporte de pagos por año")]),t._v(" "),o("div",{staticClass:"body-1"},[t._v("Consultar el pago de una persona de un año completo.")])]),t._v(" "),o("SearchPerson",{attrs:{errors:t.errors,person:t.form.persona},on:{input:function(e){return t.onPerson(e)}}}),t._v(" "),o("v-flex",{attrs:{xs12:""}},[o("span",{staticClass:"body-2 mb-2"},[t._v("El periodo del pago")])]),t._v(" "),o("v-flex",{attrs:{xs12:"",sm6:"",md3:""}},[o("div",{staticClass:"pr-2"},[o("v-select",{attrs:{items:t.items_anio,"item-text":"anio","item-value":"anio",label:"El año","error-messages":t.errors.anio},model:{value:t.form.anio,callback:function(e){t.$set(t.form,"anio",e)},expression:"form.anio"}})],1)]),t._v(" "),o("v-flex",{staticClass:"pl-2",attrs:{xs12:"",sm6:"",md3:""}},[o("v-text-field",{attrs:{label:"Número de Certificado","error-messages":t.errors.certificado},model:{value:t.form.certificado,callback:function(e){t.$set(t.form,"certificado",e)},expression:"form.certificado"}})],1),t._v(" "),o("v-flex",{attrs:{xs12:"",sm9:"",md3:""}}),t._v(" "),o("v-flex",{staticClass:"d-flex",attrs:{xs12:"",sm3:"",md3:"","justify-end":""}},[o("v-btn",{attrs:{color:"success"},on:{click:function(e){return t.buscarPago()}}},[t._v("Buscar")])],1)],1)],1)],1)],1)],1),t._v(" "),o("v-layout",{attrs:{row:"",wrap:""}},[o("v-flex",{attrs:{xs12:""}},[0!==Object.keys(t.lista_resultado).length?[o("div",{staticClass:"mb-2 d-flex justify-content-between"},[o("div",{staticClass:"title"},[t._v("Resultados encontrados")]),t._v(" "),o("div",{staticClass:"caption"},[t._v("Descargar o imprimir todos los pagos por año")])]),t._v(" "),o("v-card",[o("v-card-text",{staticClass:"d-flex justify-content-between"},[o("div",{staticClass:"details-info"},[o("div",{staticClass:"heading",domProps:{innerHTML:t._s(t.lista_resultado.anio)}}),t._v(" "),o("div",{staticClass:"body-2"},[t._v(t._s(t.getName()))])]),t._v(" "),o("div",{staticClass:"actions"},[o("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var a=e.on;return[o("v-btn",t._g({attrs:{color:"success"},on:{click:function(e){return t.downloadPDF(t.lista_resultado.anio,t.form.persona.dni)}}},a),[o("v-icon",[t._v("mdi mdi-cloud-download-outline")])],1)]}}],null,!1,1554603751)},[t._v(" "),o("span",[t._v("Descargar constancia de pago")])]),t._v(" "),o("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var a=e.on;return[o("v-btn",t._g({attrs:{color:"info"},on:{click:function(e){return t.viewPDF(t.lista_resultado.anio,t.form.persona.dni)}}},a),[o("v-icon",[t._v("mdi mdi-printer")])],1)]}}],null,!1,77256240)},[t._v(" "),o("span",[t._v("Imprimir constancia de pago")])])],1)])],1)]:t.loading?[o("v-card",[o("v-card-text",[o("div",{staticClass:"text-xs-center"},[o("v-progress-circular",{attrs:{indeterminate:"",color:"primary"}})],1)])],1)]:t.notFound?[o("v-card",[o("v-card-text",[o("div",{staticClass:"text-xs-center body-2"},[t._v(t._s(this.msg))])])],1)]:t._e()],2)],1)],1)}),[],!1,null,null,null);e.default=n.exports},77:function(t,e,o){"use strict";var a={props:["estado"]},s=o(6),n=Object(s.a)(a,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("span",["activo"===t.estado?[o("v-chip",{staticClass:"text-capitalize",attrs:{"text-color":"white",color:"success",small:""}},[t._v(t._s(t.estado))])]:t._e(),t._v(" "),"cesante"===t.estado?[o("v-chip",{staticClass:"text-capitalize",attrs:{"text-color":"white",color:"error",small:""}},[t._v(t._s(t.estado))])]:t._e(),t._v(" "),"sobreviviente"===t.estado?[o("v-chip",{staticClass:"text-capitalize",attrs:{"text-color":"white",color:"info",small:""}},[t._v(t._s(t.estado))])]:t._e()],2)}),[],!1,null,null,null);e.a=n.exports},78:function(t,e,o){"use strict";var a={components:{EstadoChip:o(77).a},props:{errors:{default:null},person:{default:null}},data:function(){return{estado:"activo",toggleActiveBtn:0,search:"",lista_personas:[],isLoading:!1,persona:{}}},computed:{getPersona:{get:function(){return this.persona=this.person&&this.person.nombre?this.person:{},this.estado=this.person&&this.person.estado?this.person.estado:this.estado,this.onSelectStatus(this.estado),this.persona},set:function(t){return this.persona=t}}},methods:{customFilter:function(t,e,o){var a=t.nombre.toLowerCase(),s=t.apellido_paterno.toLowerCase(),n=t.apellido_materno.toLowerCase(),r=t.dni.toLowerCase(),i=e.toLowerCase();return a.indexOf(i)>-1||s.indexOf(i)||n.indexOf(i)||r.indexOf(i)>-1},filterBy:function(t){this.estado=t,this.lista_personas=[],this.$emit("input",{target:{value:{}}})},onSelect:function(t){this.$emit("input",{target:{value:t}})},onSelectStatus:function(t){this.toggleActiveBtn="activo"==t?0:"sobreviviente"==t?1:"cesante"==t?2:0},getNameComplete:function(t){return void 0!==t?"".concat(t.apellido_paterno," ").concat(t.apellido_materno,", ").concat(t.nombre):""}},watch:{search:function(t){var e=this;if(!this.isLoading){this.isLoading=!0;var o={q:t,estado:this.estado};axios.get("/search-personas",{params:o}).then((function(t){e.isLoading=!1,e.lista_personas=t.data.personas})).catch((function(t){return console.log(t)})).finally((function(){return e.isLoading=!1}))}}}},s=o(6),n=Object(s.a)(a,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("v-layout",{staticClass:"mb-3",attrs:{row:"",wrap:""}},[o("v-flex",{attrs:{xs12:""}},[o("span",{staticClass:"body-2"},[t._v("Datos de la persona")])]),t._v(" "),o("v-flex",{staticClass:"mb-2 mt-2",attrs:{xs12:""}},[o("v-tooltip",{attrs:{bottom:""}},[o("v-icon",{attrs:{slot:"activator"},slot:"activator"},[t._v("$vuetify.icons.filter")]),t._v(" "),o("span",[t._v("Filtrar por estado")])],1),t._v(" "),o("v-btn-toggle",{attrs:{light:""},model:{value:t.toggleActiveBtn,callback:function(e){t.toggleActiveBtn=e},expression:"toggleActiveBtn"}},[o("v-btn",{attrs:{flat:"",color:"success"},on:{click:function(e){return t.filterBy("activo")}}},[t._v("Activos")]),t._v(" "),o("v-btn",{attrs:{flat:"",color:"info"},on:{click:function(e){return t.filterBy("sobreviviente")}}},[t._v("Sobrevivientes")]),t._v(" "),o("v-btn",{attrs:{flat:"",color:"error"},on:{click:function(e){return t.filterBy("cesante")}}},[t._v("Cesantes")])],1)],1),t._v(" "),o("v-flex",{attrs:{xs12:"",sm6:""}},[o("div",{staticClass:"pr-2"},[o("v-autocomplete",{attrs:{items:t.lista_personas,loading:t.isLoading,"search-input":t.search,"no-data-text":"Sin resultados","item-text":"nombre","item-value":"API",label:"Nombre","prepend-icon":"mdi-database-search",filter:t.customFilter,placeholder:"Buscar por Cod. Modular, DNI,  o nombre completo...","return-object":"","error-messages":t.errors.persona_id},on:{"update:searchInput":function(e){t.search=e},"update:search-input":function(e){t.search=e},change:t.onSelect},scopedSlots:t._u([{key:"item",fn:function(e){return[o("v-list-tile-content",[o("v-list-tile-title",[t._v(t._s(t.getNameComplete(e.item)))]),t._v(" "),o("v-list-tile-sub-title",[o("span",[t._v("DNI: "+t._s(e.item.dni)+" -")]),t._v(" "),o("span",[t._v("COD. MODULAR: "+t._s(e.item.codigo_modular))])])],1)]}}]),model:{value:t.getPersona,callback:function(e){t.getPersona=e},expression:"getPersona"}})],1)]),t._v(" "),o("v-flex",{attrs:{xs12:""}},[o("transition",{attrs:{name:"slide-fade"}},[0!==Object.keys(t.getPersona).length?o("v-card",{staticClass:"pa-2",attrs:{outlined:""}},[o("div",{staticClass:"title mb-1"},[t._v(t._s(t.getNameComplete(t.getPersona)))]),t._v(" "),o("div",{staticClass:"subtitle-1"},[o("div",[o("span",{staticClass:"font-weight-bold"},[t._v("DNI:")]),t._v("\n            "+t._s(t.getPersona.dni)+"\n          ")]),t._v(" "),o("div",[o("span",{staticClass:"font-weight-bold"},[t._v("COD. MODULAR:")]),t._v("\n            "+t._s(t.getPersona.codigo_modular)+"\n          ")]),t._v(" "),o("div",[o("span",{staticClass:"font-weight-bold"},[t._v("ESTADO:")]),t._v(" "),o("EstadoChip",{attrs:{estado:t.getPersona.estado}})],1)])]):t._e()],1)],1)],1)}),[],!1,null,null,null);e.a=n.exports}}]);